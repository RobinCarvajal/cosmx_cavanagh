# Data Disk ----------------------------------------------------------
disk <- "F:"
# Scripts Directory -------------------------------------------------------
scripts_dir <- file.path(disk, "cosmx_scripts")
# Set up Directory --------------------------------------------------------
setup_dir <- file.path(scripts_dir,"set_up")
# Data Directories --------------------------------------------------------
data_dir <- file.path(disk, "cosmx_data")
##### objects #####
objects_dir <- file.path(data_dir, "objects")
##### single cell #####
single_cell_dir <- file.path(data_dir, "single_cell")
##### niches #####
niches_dir <- file.path(data_dir, "niches")
#### running scripts
# Libraries
source(file.path(setup_dir, "Libraries.R"))
# Functions
source(file.path(setup_dir, "Functions.R"))
source(file.path(setup_dir, "FN_differential_expression.R"))
#read pseudo object
pseudo_brain <- readRDS(file.path(data_dir,"de_utils",
"fine.labels_pseudo_bulk.RDS"))
# Code  --------------------------------------------------------------------
celltype <- "Immune.4"
# out path
celltype_path <- file.path(data_dir,"fine_single_cell","differential_expression", "condition", "cell_types", celltype)
# make dir
if (!dir.exists(celltype_path)) {dir.create(celltype_path, recursive = TRUE)}
cluster_df <- as.data.frame(pseudo_brain[[celltype]])
cluster_df$ID <- rownames(cluster_df)
cluster_df <- cluster_df[, c("ID", setdiff(names(cluster_df), "ID"))]
View(cluster_df)
# save
write.table(cluster_df,
file = file.path(celltype_path, paste0("em_", celltype, ".tsv")),
sep = "\t",
row.names = FALSE,
quote = FALSE)
# get the celltype
counts <- pseudo_brain[[celltype]]
View(counts)
# generate sample level metadata
ss <- tibble(sample = colnames(counts))
segments <- c(4) # condition
replacement <- paste0("\\", segments[1])
# modified so that Searchligth2 will accept it
ss$sample_group <- gsub('^([^_]+)_([^_]+)+_([^_]+)_([^_]+)$',
replacement,
colnames(counts))
base_path <- file.path(data_dir,"fine_single_cell","differential_expression", "condition", "cell_types")
# out path
celltype_path <- file.path(base_path, celltype)
# make dir
if (!dir.exists(celltype_path)) {dir.create(celltype_path, recursive = TRUE)}
# em path
em <- pseudo_brain[[celltype]]
ss <- ss_list[[celltype]]
# Control vs Aldara
GetDE_fn(em_df = em,
celltype = celltype,
suffix = "C_vs_A",
sample_sheet = ss,
reference = "C",
contrast = "A",
p_threshold = 0.5,
fold_threshold = 1,
out = celltype_path )
